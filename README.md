# –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ PostgreSQL –≤ ClickHouse —á–µ—Ä–µ–∑ Kafka
–°–∫—Ä–∏–ø—Ç—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã user_login –≤ PostgreSQL –≤ —Ç–∞–±–ª–∏—Ü—É 
user_login –≤ ClickHouse —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Kafka –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞. 

–û—Å–Ω–æ–≤–Ω–æ–π —Ü–µ–ª—å—é —è–≤–ª—è–µ—Ç—Å—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ—Ç–µ—Ä–∏ —Å–æ–±—ã—Ç–∏–π.

## üëâ –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –∫–æ–¥
### 1. –§–∞–π–ª produser.py
–ó–∞–¥–∞—á–∞ —ç—Ç–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ ‚Äî —Å–æ–±—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∏–∑ PostgreSQL –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –≤ Kafka.

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
 - –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL, –∏ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ Kafka (—ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –ø–æ–ª–µ–º sent_to_kafka).
–ö–∞–∂–¥–∞—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ JSON –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Kafka.
 - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å –≤ PostgreSQL –æ—Ç–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –∑–Ω–∞—á–µ–Ω–∏–µ 
–ø–æ–ª—è sent_to_kafka —Ä–∞–≤–Ω—ã–º TRUE.
 - –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —ç—Ç–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Kafka.

### 2. –§–∞–π–ª consumer.py
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –ø—Ä–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Kafka –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –∏—Ö –≤ ClickHouse.

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
 - –°–æ–∑–¥–∞–µ—Ç—Å—è Kafka-–∫–æ–Ω—Å—É–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ç–µ–º—É (user_event).
 - –ü–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ–Ω–∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è –∏–∑ JSON –∏ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É –≤ ClickHouse.
 - –¢–µ–º —Å–∞–º—ã–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω–µ—á–Ω—ã–π –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.


## üîπ –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞
–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É user_login.
```
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã user_login
CREATE TABLE IF NOT EXISTS user_login (
    id SERIAL PRIMARY KEY,  -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–π—Å—è
    username TEXT,           -- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    event_type TEXT,         -- –¢–∏–ø —Å–æ–±—ã—Ç–∏—è (–ª–æ–≥–∏–Ω, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–∫—É–ø–∫–∞ –∏ —Ç.–¥.)
    event_time TIMESTAMP,    -- –í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è
    sent_to_kafka BOOLEAN DEFAULT FALSE  -- –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–∏ —Å–æ–±—ã—Ç–∏–µ –≤ Kafka (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é FALSE)
);

-- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO user_login (username, event_type, event_time) VALUES
('john_doe', 'login', '2023-10-26 10:00:00'),
('jane_smith', 'register', '2023-10-26 10:15:00'),
('john_doe', 'purchase', '2023-10-26 10:30:00'),
('bob_builder', 'login', '2023-10-26 11:00:00'),
('alice_wonderland', 'register', '2023-10-26 11:15:00'),
('bob_builder', 'purchase', '2023-10-26 11:30:00'),
('john_doe', 'logout', '2023-10-26 12:00:00'),
('jane_smith', 'login', '2023-10-26 12:15:00');

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª–µ–µ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Kafka
INSERT INTO user_login (username, event_type, event_time) VALUES
('john_doe', 'login', '2024-11-15 14:00:00'),
('jane_smith', 'register', '2024-11-15 14:15:00');
```
–†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Kafka (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Docker Compose).
–ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞ (produser.py):

``` 
python produser.py 
```
–ü—Ä–æ–¥—é—Å–µ—Ä –Ω–∞—á–Ω–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∏–∑ PostgreSQL –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –≤ Kafka.
–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Å—É–º–µ—Ä–∞ (¬´consumer.py¬ª):
```
python consumer.py
```
–ö–æ–Ω—Å—É–º–µ—Ä –Ω–∞—á–Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ Kafka –∏ –Ω–∞—á–Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ ClickHouse.

## üî∂ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ produser.py:
 - –ó–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ PostgreSQL, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Kafka.
 - –û–Ω–∏ —É–ø–∞–∫–æ–≤—ã–≤–∞—é—Ç—Å—è –≤ JSON –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Kafka-—Ç–µ–º—É.
 - –ü–æ–ª–µ sent_to_kafka –≤ —Ç–∞–±–ª–∏—Ü–µ user_login –≤ –ë–î PostgreSQL –º–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å FALSE –Ω–∞ TRUE, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ—Ç–º–µ—Ç–∫—É –æ –¥–æ—Å—Ç–∞–≤–∫–µ.

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ consumer.py:
 - –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∞ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Kafka.
 - –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ ClickHouse.

## üí• –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã
–ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–∞–Ω–Ω—ã–µ –æ–∫–∞–∂—É—Ç—Å—è –≤ ClickHouse, –∏ –¥–∞–ª—å–Ω–µ–π—à–∏–π –∑–∞–ø—É—Å–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ 
–æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—Å–µ–π 
–ø—Ä–æ—Ü–µ–¥—É—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–∏.



